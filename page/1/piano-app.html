<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>电子钢琴</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    
    #root {
      width: 100%;
      max-width: 1200px;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;
    
    const Piano = () => {
      const [isPlaying, setIsPlaying] = useState(false);
      const [volume, setVolume] = useState(0.5);
      const [isMuted, setIsMuted] = useState(false);
      const [activeKeys, setActiveKeys] = useState(new Set());
      const [audioContextSupported, setAudioContextSupported] = useState(true);
      
      const audioContextRef = useRef(null);
      const oscillatorsRef = useRef(new Map());
      const gainNodeRef = useRef(null);
      const isInitializedRef = useRef(false);
      
      // 记录活跃音符的防抖计时器
      const activeKeysTimersRef = useRef(new Map());
      // 添加按键状态跟踪，防止重复触发
      const keysPressedRef = useRef({});
      // 添加最后播放时间戳，用于节流
      const lastPlayedTimeRef = useRef({});

      // 钢琴键配置 - 包含白键和黑键，扩展白键范围
      const keys = [
        { note: 'C', frequency: 261.63, type: 'white', keyBinding: 'a' },
        { note: 'C#', frequency: 277.18, type: 'black', keyBinding: 'w' },
        { note: 'D', frequency: 293.66, type: 'white', keyBinding: 's' },
        { note: 'D#', frequency: 311.13, type: 'black', keyBinding: 'e' },
        { note: 'E', frequency: 329.63, type: 'white', keyBinding: 'd' },
        { note: 'F', frequency: 349.23, type: 'white', keyBinding: 'f' },
        { note: 'F#', frequency: 369.99, type: 'black', keyBinding: 't' },
        { note: 'G', frequency: 392.00, type: 'white', keyBinding: 'g' },
        { note: 'G#', frequency: 415.30, type: 'black', keyBinding: 'y' },
        { note: 'A', frequency: 440.00, type: 'white', keyBinding: 'h' },
        { note: 'A#', frequency: 466.16, type: 'black', keyBinding: 'u' },
        { note: 'B', frequency: 493.88, type: 'white', keyBinding: 'j' },
        { note: 'C2', frequency: 523.25, type: 'white', keyBinding: 'k' },
        { note: 'C#2', frequency: 554.37, type: 'black', keyBinding: 'o' },
        { note: 'D2', frequency: 587.33, type: 'white', keyBinding: 'l' },
        { note: 'D#2', frequency: 622.25, type: 'black', keyBinding: 'p' },
        { note: 'E2', frequency: 659.25, type: 'white', keyBinding: ';' },
        { note: 'F2', frequency: 698.46, type: 'white', keyBinding: ',' },
        { note: 'G2', frequency: 783.99, type: 'white', keyBinding: '.' }
      ];

      // Call of Silence 乐谱
      const fullSheetMusic = [
        // 第一行9个音符
        { note: ';', keyBinding: ';' },
        { note: 'L', keyBinding: 'l' },
        { note: 'L', keyBinding: 'l' },
        { note: 'K', keyBinding: 'k' },
        { note: 'K', keyBinding: 'k' },
        { note: '.', keyBinding: '.' },
        { note: 'K', keyBinding: 'k' },
        { note: 'J', keyBinding: 'j' },
        { note: 'K', keyBinding: 'k' },
        
        // 第二行9个音符
        { note: ';', keyBinding: ';' },
        { note: 'L', keyBinding: 'l' },
        { note: 'L', keyBinding: 'l' },
        { note: 'K', keyBinding: 'k' },
        { note: 'G', keyBinding: 'g' },
        { note: ';', keyBinding: ';' },
        { note: 'L', keyBinding: 'l' },
        { note: ';', keyBinding: ';' },
        { note: 'K', keyBinding: 'k' },
        
        // 第三行10个音符
        { note: ';', keyBinding: ';' },
        { note: 'L', keyBinding: 'l' },
        { note: 'L', keyBinding: 'l' },
        { note: 'K', keyBinding: 'k' },
        { note: 'K', keyBinding: 'k' },
        { note: '.', keyBinding: '.' },
        { note: '.', keyBinding: '.' },
        { note: '.', keyBinding: '.' },
        { note: 'L', keyBinding: 'l' },
        { note: 'K', keyBinding: 'k' },
        
        // 第四行10个音符
        { note: 'H', keyBinding: 'h' },
        { note: 'K', keyBinding: 'k' },
        { note: 'L', keyBinding: 'l' },
        { note: 'L', keyBinding: 'l' },
        { note: 'K', keyBinding: 'k' },
        { note: 'L', keyBinding: 'l' },
        { note: ';', keyBinding: ';' },
        { note: 'L', keyBinding: 'l' },
        { note: 'L', keyBinding: 'l' },
        { note: 'K', keyBinding: 'k' },
      ];

      // 检查Web Audio API支持
      useEffect(() => {
        if (!window.AudioContext && !window.webkitAudioContext) {
          console.error('浏览器不支持Web Audio API');
          setAudioContextSupported(false);
        }
      }, []);

      // 初始化 Web Audio API
      const initAudioContext = useCallback(() => {
        if (isInitializedRef.current || !audioContextSupported) return;

        try {
          // 仅在用户交互时创建AudioContext，避免自动播放限制
          const AudioContext = window.AudioContext || window.webkitAudioContext;
          if (!AudioContext) {
            setAudioContextSupported(false);
            return;
          }
          
          audioContextRef.current = new AudioContext();
          gainNodeRef.current = audioContextRef.current.createGain();
          gainNodeRef.current.connect(audioContextRef.current.destination);
          gainNodeRef.current.gain.value = isMuted ? 0 : volume;
          isInitializedRef.current = true;
          
          // 防止音频上下文挂起
          if (audioContextRef.current.state === 'suspended') {
            audioContextRef.current.resume().catch(err => {
              console.warn('无法恢复音频上下文:', err);
            });
          }
        } catch (error) {
          console.error('Web Audio API 初始化失败:', error);
          setAudioContextSupported(false);
        }
      }, [volume, isMuted, audioContextSupported]);

      // 更新音量
      useEffect(() => {
        if (gainNodeRef.current) {
          gainNodeRef.current.gain.value = isMuted ? 0 : volume;
        }
      }, [volume, isMuted]);

      // 组件卸载时清理资源
      useEffect(() => {
        return () => {
          // 清理所有计时器
          activeKeysTimersRef.current.forEach(timerId => clearTimeout(timerId));
          activeKeysTimersRef.current.clear();
          
          // 停止所有音符
          if (oscillatorsRef.current.size > 0) {
            oscillatorsRef.current.forEach((data, note) => {
              try {
                const { oscillator, envelope } = data;
                if (oscillator) {
                  oscillator.stop();
                  oscillator.disconnect();
                }
                if (envelope) {
                  envelope.disconnect();
                }
              } catch (e) {
                console.warn('清理音符失败:', e);
              }
            });
            oscillatorsRef.current.clear();
          }

          // 关闭音频上下文
          if (audioContextRef.current && audioContextRef.current.state !== 'closed') {
            try {
              audioContextRef.current.close();
            } catch (err) {
              console.warn('关闭AudioContext失败:', err);
            }
          }
          
          // 重置按键状态
          keysPressedRef.current = {};
          // 重置最后播放时间
          lastPlayedTimeRef.current = {};
        };
      }, []);

      // 改进后的播放音符函数
      const playNote = useCallback((frequency, note) => {
        if (!audioContextSupported) return;
        
        initAudioContext(); // 确保AudioContext已初始化
        
        if (!audioContextRef.current || isMuted) return;

        // 实现节流 - 每个音符独立计时
        const now = Date.now();
        const lastPlayed = lastPlayedTimeRef.current[note] || 0;
        if (now - lastPlayed < 100) { // 100ms内不重复触发同一音符
          return;
        }
        lastPlayedTimeRef.current[note] = now;

        try {
          // 如果已有相同音符在播放，先停止它
          if (oscillatorsRef.current.has(note)) {
            const { oscillator, envelope } = oscillatorsRef.current.get(note);
            
            // 确保安全停止之前的振荡器
            try {
              oscillator.stop();
              oscillator.disconnect();
              envelope.disconnect();
            } catch (e) {
              // 忽略已停止的振荡器错误
            }
            
            oscillatorsRef.current.delete(note);
          }

          // 防止上下文挂起
          if (audioContextRef.current.state === 'suspended') {
            audioContextRef.current.resume().catch(() => {
              return; // 如果无法恢复，则退出函数
            });
          }

          // 使用固定数量的振荡器池限制
          if (oscillatorsRef.current.size >= 10) { // 限制最多10个同时发声的音符
            // 找到最早播放的音符并停止它
            const oldestNote = Array.from(oscillatorsRef.current.keys())[0];
            const { oscillator, envelope } = oscillatorsRef.current.get(oldestNote);
            try {
              oscillator.stop();
              oscillator.disconnect();
              envelope.disconnect();
            } catch (e) {
              // 忽略错误
            }
            oscillatorsRef.current.delete(oldestNote);
          }

          const oscillator = audioContextRef.current.createOscillator();
          const envelope = audioContextRef.current.createGain();

          oscillator.type = 'triangle'; // 使用三角波获得更温暖的音色
          oscillator.frequency.setValueAtTime(frequency, audioContextRef.current.currentTime);

          // 设置音符包络（ADSR）- 简化为更快的响应
          envelope.gain.setValueAtTime(0, audioContextRef.current.currentTime);
          envelope.gain.linearRampToValueAtTime(0.7, audioContextRef.current.currentTime + 0.01);
          envelope.gain.exponentialRampToValueAtTime(0.6, audioContextRef.current.currentTime + 0.05);

          oscillator.connect(envelope);
          envelope.connect(gainNodeRef.current);

          oscillator.start();
          oscillatorsRef.current.set(note, { oscillator, envelope });

          // 更新活跃键状态
          setActiveKeys(prev => {
            const newSet = new Set(prev);
            newSet.add(note);
            return newSet;
          });

          // 自动在短时间后移除活跃状态（视觉反馈）
          setTimeout(() => {
            setActiveKeys(prev => {
              const newSet = new Set(prev);
              newSet.delete(note);
              return newSet;
            });
          }, 200);
          
        } catch (error) {
          console.error('播放音符失败:', error);
        }
      }, [isMuted, audioContextSupported, initAudioContext]);

      // 停止音符
      const stopNote = useCallback((note) => {
        if (!audioContextSupported || !audioContextRef.current) return;
        
        const noteData = oscillatorsRef.current.get(note);
        if (noteData) {
          const { oscillator, envelope } = noteData;
          try {
            // 固定释放时间
            const releaseTime = 0.2;
            
            // 优化释放包络
            const currentTime = audioContextRef.current.currentTime;
            envelope.gain.cancelScheduledValues(currentTime);
            envelope.gain.setValueAtTime(envelope.gain.value, currentTime);
            envelope.gain.exponentialRampToValueAtTime(0.001, currentTime + releaseTime);
            
            // 添加超时确保振荡器被停止
            setTimeout(() => {
              try {
                oscillator.stop();
                oscillator.disconnect();
                envelope.disconnect();
                oscillatorsRef.current.delete(note);
              } catch (e) {
                // 忽略已停止的振荡器错误
              }
            }, releaseTime * 1000);
          } catch (error) {
            // 发生错误时强制清理
            try {
              oscillator.disconnect();
              envelope.disconnect();
              oscillatorsRef.current.delete(note);
            } catch (e) {
              // 最终清理尝试
            }
          }
        }
      }, [audioContextSupported]);

      // 停止所有音符
      const stopAllNotes = useCallback(() => {
        if (!audioContextSupported || !audioContextRef.current) return;
        
        const notesToStop = Array.from(oscillatorsRef.current.keys());
        
        // 停止所有UI激活状态
        setActiveKeys(new Set());
        
        // 批量停止音频
        notesToStop.forEach(note => {
          const noteData = oscillatorsRef.current.get(note);
          if (noteData) {
            try {
              const { oscillator, envelope } = noteData;
              // 快速淡出所有音符
              const currentTime = audioContextRef.current.currentTime;
              envelope.gain.cancelScheduledValues(currentTime);
              envelope.gain.setValueAtTime(envelope.gain.value, currentTime);
              envelope.gain.exponentialRampToValueAtTime(0.001, currentTime + 0.05);
              
              // 100ms后彻底清理
              setTimeout(() => {
                try {
                  oscillator.stop();
                  oscillator.disconnect();
                  envelope.disconnect();
                } catch (e) {
                  // 忽略已停止的振荡器错误
                }
              }, 100);
            } catch (error) {
              console.error('停止音符失败:', error);
            }
          }
        });
        
        // 重置振荡器映射
        setTimeout(() => {
          oscillatorsRef.current.clear();
        }, 150);
      }, [audioContextSupported]);

      // 处理键盘事件
      useEffect(() => {
        const handleKeyDown = (event) => {
          // 如果焦点在输入框或文本区域，不处理键盘事件
          if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;
          
          // 防止按住键盘重复触发
          if (event.repeat || keysPressedRef.current[event.key.toLowerCase()]) return;
          
          const key = keys.find(k => k.keyBinding === event.key.toLowerCase());
          if (key) {
            // 标记按键为已按下
            keysPressedRef.current[event.key.toLowerCase()] = true;
            playNote(key.frequency, key.note);
          }
        };

        const handleKeyUp = (event) => {
          // 如果焦点在输入框或文本区域，不处理键盘事件
          if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;
          
          const key = keys.find(k => k.keyBinding === event.key.toLowerCase());
          if (key) {
            // 移除按键标记
            delete keysPressedRef.current[event.key.toLowerCase()];
            
            // 直接停止音符
            stopNote(key.note);
          }
        };
        
        // 页面失去焦点时释放所有按键
        const handleBlur = () => {
          keysPressedRef.current = {};
          stopAllNotes();
        };
        
        // 页面切换时释放资源
        const handleVisibilityChange = () => {
          if (document.hidden) {
            keysPressedRef.current = {};
            stopAllNotes();
          }
        };

        window.addEventListener('keydown', handleKeyDown);
        window.addEventListener('keyup', handleKeyUp);
        window.addEventListener('blur', handleBlur);
        document.addEventListener('visibilitychange', handleVisibilityChange);

        return () => {
          window.removeEventListener('keydown', handleKeyDown);
          window.removeEventListener('keyup', handleKeyUp);
          window.removeEventListener('blur', handleBlur);
          document.removeEventListener('visibilitychange', handleVisibilityChange);
        };
      }, [playNote, stopNote, stopAllNotes]);

      // 鼠标/触摸事件处理
      const handleMouseDown = useCallback((key) => {
        playNote(key.frequency, key.note);
      }, [playNote]);

      const handleMouseUp = useCallback((key) => {
        // 直接停止音符
        stopNote(key.note);
      }, [stopNote]);

      // 切换静音
      const toggleMute = useCallback(() => {
        setIsMuted(!isMuted);
        if (!isMuted) {
          stopAllNotes();
        }
      }, [isMuted, stopAllNotes]);

      // 错误边界处理 - 如果不支持Web Audio API，显示友好提示
      if (!audioContextSupported) {
        return (
          <div className="piano-container">
            <div className="piano-error">
              <i className="fas fa-music" style={{ fontSize: '2em' }}></i>
              <h3>抱歉，您的浏览器不支持Web Audio API</h3>
              <p>请尝试使用最新版的Chrome、Firefox或Safari浏览器。</p>
            </div>
            
            <style data-jsx>{`
              .piano-container {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 16px;
                padding: 25px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
              }
              
              .piano-error {
                text-align: center;
                padding: 40px 20px;
                color: white;
              }
              
              .piano-error h3 {
                margin: 15px 0;
                font-size: 1.5em;
              }
              
              .piano-error p {
                opacity: 0.8;
              }
            `}</style>
          </div>
        );
      }

      return (
        <div className="piano-container">
          {/* 控制面板 */}
          <div className="piano-controls">
            <div className="controls-left">
              <button 
                className={`control-btn ${isMuted ? 'muted' : ''}`}
                onClick={toggleMute}
                title={isMuted ? '取消静音' : '静音'}
              >
                <i className={`fas ${isMuted ? 'fa-volume-mute' : 'fa-volume-up'}`}></i>
              </button>
              
              <div className="volume-control">
                <input
                  type="range"
                  min="0"
                  max="1"
                  step="0.1"
                  value={volume}
                  onChange={(e) => setVolume(parseFloat(e.target.value))}
                  className="volume-slider"
                  title="音量"
                />
                <span className="volume-value">{Math.round(volume * 100)}%</span>
              </div>
            </div>

            <div className="piano-title">
              <i className="fas fa-music"></i>
              <span>电子钢琴</span>
            </div>

            <div className="controls-right">
              {/* 占位区域保持布局平衡 */}
            </div>
          </div>

          {/* 钢琴键盘 */}
          <div className="piano-keyboard">
            <div className="keys-container">
              {/* 白键 */}
              <div className="white-keys">
                {keys.filter(key => key.type === 'white').map((key) => (
                  <button
                    key={key.note}
                    className={`piano-key white-key ${activeKeys.has(key.note) ? 'active' : ''}`}
                    onMouseDown={() => handleMouseDown(key)}
                    onMouseUp={() => handleMouseUp(key)}
                    onMouseLeave={() => handleMouseUp(key)}
                    onTouchStart={(e) => {
                      e.preventDefault();
                      handleMouseDown(key);
                    }}
                    onTouchEnd={(e) => {
                      e.preventDefault();
                      handleMouseUp(key);
                    }}
                  >
                    <span className="key-label">{key.note}</span>
                    <span className="key-binding">{key.keyBinding.toUpperCase()}</span>
                  </button>
                ))}
              </div>

              {/* 黑键 */}
              <div className="black-keys">
                {keys.filter(key => key.type === 'black').map((key, index) => {
                  // 计算黑键的位置
                  const whiteKeyIndex = keys.filter(k => k.type === 'white').findIndex(k => 
                    keys.indexOf(k) > keys.indexOf(key)
                  );
                  const leftOffset = whiteKeyIndex === -1 ? 
                    keys.filter(k => k.type === 'white').length * 54 - 20 : 
                    whiteKeyIndex * 54 - 20;

                  return (
                    <button
                      key={key.note}
                      className={`piano-key black-key ${activeKeys.has(key.note) ? 'active' : ''}`}
                      style={{ left: `${leftOffset}px` }}
                      onMouseDown={() => handleMouseDown(key)}
                      onMouseUp={() => handleMouseUp(key)}
                      onMouseLeave={() => handleMouseUp(key)}
                      onTouchStart={(e) => {
                        e.preventDefault();
                        handleMouseDown(key);
                      }}
                      onTouchEnd={(e) => {
                        e.preventDefault();
                        handleMouseUp(key);
                      }}
                    >
                      <span className="key-label">{key.note}</span>
                      <span className="key-binding">{key.keyBinding.toUpperCase()}</span>
                    </button>
                  );
                })}
              </div>
            </div>
          </div>

          {/* 使用提示 */}
          <div className="piano-instructions">
            <div className="instruction-item">
              <i className="fas fa-keyboard"></i>
              <span>使用键盘按键或点击琴键演奏</span>
            </div>
            <div className="instruction-item">
              <span>白键: A S D F G H J K L ; , .</span>
            </div>
            <div className="instruction-item">
              <span>黑键: W E T Y U O P</span>
            </div>
          </div>

          {/* Call of Silence 乐谱 */}
          <div className="sheet-music-container">
            <div className="sheet-music-header">
              <h3>《Call of Silence》</h3>
            </div>

            <div className="sheet-music">
              {/* 第一行 - 9个音符 */}
              <div className="note-row">
                {fullSheetMusic.slice(0, 9).map((noteItem, index) => (
                  <div key={index} className="note-item">
                    <div className="note-box">
                      <div className="note-name">{noteItem.note}</div>
                      <div className="key-binding">{noteItem.keyBinding}</div>
                    </div>
                    {index < 8 && <div className="note-arrow">→</div>}
                  </div>
                ))}
              </div>
              
              {/* 第二行 - 9个音符 */}
              <div className="note-row">
                {fullSheetMusic.slice(9, 18).map((noteItem, index) => (
                  <div key={index + 9} className="note-item">
                    <div className="note-box">
                      <div className="note-name">{noteItem.note}</div>
                      <div className="key-binding">{noteItem.keyBinding}</div>
                    </div>
                    {index < 8 && <div className="note-arrow">→</div>}
                  </div>
                ))}
              </div>
              
              {/* 第三行 - 10个音符 */}
              <div className="note-row">
                {fullSheetMusic.slice(18, 28).map((noteItem, index) => (
                  <div key={index + 18} className="note-item">
                    <div className="note-box">
                      <div className="note-name">{noteItem.note}</div>
                      <div className="key-binding">{noteItem.keyBinding}</div>
                    </div>
                    {index < 9 && <div className="note-arrow">→</div>}
                  </div>
                ))}
              </div>
              
              {/* 第四行 - 10个音符 */}
              <div className="note-row">
                {fullSheetMusic.slice(28).map((noteItem, index) => (
                  <div key={index + 28} className="note-item">
                    <div className="note-box">
                      <div className="note-name">{noteItem.note}</div>
                      <div className="key-binding">{noteItem.keyBinding}</div>
                    </div>
                    {index < 9 && <div className="note-arrow">→</div>}
                  </div>
                ))}
              </div>
            </div>
          </div>

          <style data-jsx>{`
            .piano-container {
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              border-radius: 16px;
              padding: 25px;
              box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
              position: relative;
              overflow: hidden;
              user-select: none;
            }

            .piano-container::before {
              content: '';
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background: url('https://picsum.photos/800/600?blur=2') no-repeat center;
              background-size: cover;
              opacity: 0.05;
              z-index: 0;
            }

            .piano-container > * {
              position: relative;
              z-index: 1;
            }

            .piano-controls {
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 25px;
              padding: 15px 20px;
              background: rgba(255, 255, 255, 0.1);
              border-radius: 12px;
              backdrop-filter: blur(10px);
              border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .controls-left,
            .controls-right {
              display: flex;
              align-items: center;
              gap: 15px;
              flex: 1;
            }

            .controls-right {
              justify-content: flex-end;
            }

            .piano-title {
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 10px;
              color: white;
              font-size: 1.2em;
              font-weight: 600;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
              text-align: center;
              flex: 1;
            }

            .control-btn {
              display: flex;
              align-items: center;
              gap: 6px;
              padding: 10px 16px;
              background: rgba(255, 255, 255, 0.2);
              border: 1px solid rgba(255, 255, 255, 0.3);
              border-radius: 8px;
              color: white;
              cursor: pointer;
              transition: all 0.3s ease;
              font-size: 0.9em;
            }

            .control-btn:hover {
              background: rgba(255, 255, 255, 0.3);
              transform: translateY(-1px);
            }

            .control-btn.active {
              background: rgba(16, 185, 129, 0.8);
              border-color: rgba(16, 185, 129, 1);
            }

            .control-btn.muted {
              background: rgba(239, 68, 68, 0.8);
              border-color: rgba(239, 68, 68, 1);
            }

            .volume-control {
              display: flex;
              align-items: center;
              gap: 10px;
            }

            .volume-slider {
              width: 80px;
              height: 4px;
              background: rgba(255, 255, 255, 0.3);
              border-radius: 2px;
              outline: none;
              cursor: pointer;
            }

            .volume-slider::-webkit-slider-thumb {
              appearance: none;
              width: 16px;
              height: 16px;
              background: white;
              border-radius: 50%;
              cursor: pointer;
              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            }

            .volume-value {
              color: white;
              font-size: 0.8em;
              min-width: 35px;
              text-align: right;
            }

            .piano-keyboard {
              background: linear-gradient(to bottom, #2c3e50, #34495e);
              border-radius: 12px;
              padding: 30px 20px 20px;
              box-shadow: inset 0 5px 15px rgba(0, 0, 0, 0.3);
              margin-bottom: 20px;
            }

            .keys-container {
              position: relative;
              height: 200px;
              max-width: 100%;
              overflow-x: visible;
              overflow-y: visible;
            }

            .white-keys {
              display: flex;
              gap: 2px;
              height: 100%;
            }

            .black-keys {
              position: absolute;
              top: 0;
              left: 0;
              height: 120px;
            }

            .piano-key {
              border: none;
              cursor: pointer;
              transition: all 0.15s ease;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: flex-end;
              padding: 10px 5px;
              font-size: 0.7em;
              font-weight: 500;
              position: relative;
              overflow: hidden;
            }

            .white-key {
              width: 54px;
              height: 200px;
              background: linear-gradient(to bottom, #ffffff, #f8f9fa);
              border: 1px solid #dee2e6;
              border-radius: 0 0 8px 8px;
              color: #495057;
              box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }

            .white-key:hover {
              background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
              transform: translateY(2px);
            }

            .white-key.active {
              background: linear-gradient(to bottom, #4f46e5, #6366f1);
              color: white;
              transform: translateY(4px);
              box-shadow: inset 0 3px 8px rgba(0, 0, 0, 0.3);
            }

            .black-key {
              width: 30px;
              height: 120px;
              background: linear-gradient(to bottom, #212529, #343a40);
              border: 1px solid #000;
              border-radius: 0 0 6px 6px;
              color: white;
              position: absolute;
              z-index: 2;
              box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
            }

            .black-key:hover {
              background: linear-gradient(to bottom, #343a40, #495057);
              transform: translateY(2px);
            }

            .black-key.active {
              background: linear-gradient(to bottom, #6366f1, #4f46e5);
              transform: translateY(4px);
              box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.5);
            }

            .key-label {
              margin-bottom: 4px;
              font-weight: 600;
            }

            .key-binding {
              font-size: 0.8em;
              opacity: 0.7;
              background: rgba(0, 0, 0, 0.1);
              padding: 2px 4px;
              border-radius: 3px;
            }

            .black-key .key-binding {
              background: rgba(255, 255, 255, 0.1);
            }

            .piano-instructions {
              display: flex;
              flex-wrap: wrap;
              justify-content: center;
              gap: 20px;
              color: rgba(255, 255, 255, 0.9);
              font-size: 0.9em;
              text-align: center;
              margin-bottom: 30px;
            }

            .instruction-item {
              display: flex;
              align-items: center;
              gap: 8px;
              padding: 8px 12px;
              background: rgba(255, 255, 255, 0.1);
              border-radius: 6px;
              backdrop-filter: blur(5px);
            }

            /* 乐谱样式 */
            .sheet-music-container {
              background: rgba(255, 255, 255, 0.1);
              border-radius: 16px;
              padding: 25px;
              margin-top: 30px;
              backdrop-filter: blur(10px);
              border: 1px solid rgba(255, 255, 255, 0.2);
              animation: fadeIn 0.5s ease;
            }

            .sheet-music-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
              padding-bottom: 12px;
              border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            }

            .sheet-music-header h3 {
              color: white;
              font-size: 1.3em;
              font-weight: 600;
              margin: 0;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }

            .sheet-music {
              display: flex;
              flex-direction: column;
              gap: 20px;
              padding: 15px;
              background: rgba(0, 0, 0, 0.1);
              border-radius: 10px;
              overflow-x: auto;
            }
            
            .note-row {
              display: flex;
              flex-wrap: nowrap;
              align-items: center;
              gap: 5px;
              margin-bottom: 15px;
            }

            .note-item {
              display: flex;
              align-items: center;
              gap: 5px;
            }

            .note-box {
              width: 40px;
              height: 60px;
              background: rgba(255, 255, 255, 0.9);
              border-radius: 8px;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
              color: #333;
              transition: all 0.2s ease;
            }

            .note-box:hover {
              transform: translateY(-3px);
              background: white;
              box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            }

            .note-name {
              font-size: 1.3em;
              font-weight: 700;
              color: #4f46e5;
            }

            .note-box .key-binding {
              background: #f3f4f6;
              color: #374151;
              padding: 2px 6px;
              border-radius: 4px;
              font-weight: 600;
              font-size: 0.9em;
            }

            .note-arrow {
              font-size: 1.2em;
              color: rgba(255, 255, 255, 0.7);
            }

            /* 键盘动画效果 */
            @keyframes keyPress {
              0% { transform: translateY(0); }
              50% { transform: translateY(3px); }
              100% { transform: translateY(0); }
            }

            .piano-key.active {
              animation: keyPress 0.15s ease;
            }

            /* 音波效果 */
            .piano-key.active::after {
              content: '';
              position: absolute;
              top: 50%;
              left: 50%;
              width: 20px;
              height: 20px;
              background: radial-gradient(circle, rgba(255, 255, 255, 0.6) 0%, transparent 70%);
              border-radius: 50%;
              transform: translate(-50%, -50%);
              animation: ripple 0.6s ease-out;
            }

            @keyframes ripple {
              0% {
                width: 0;
                height: 0;
                opacity: 1;
              }
              100% {
                width: 60px;
                height: 60px;
                opacity: 0;
              }
            }

            @keyframes fadeIn {
              from { opacity: 0; transform: translateY(10px); }
              to { opacity: 1; transform: translateY(0); }
            }

            /* 响应式设计 */
            @media (max-width: 768px) {
              .piano-container {
                padding: 20px;
              }

              .piano-controls {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
              }

              .controls-left,
              .controls-right {
                width: 100%;
                justify-content: center;
                flex: none;
              }

              .piano-title {
                width: 100%;
                flex: none;
              }

              .keys-container {
                height: 160px;
              }

              .white-key {
                width: 45px;
                height: 160px;
              }

              .black-key {
                width: 25px;
                height: 100px;
              }

              .piano-instructions {
                flex-direction: column;
                gap: 10px;
              }

              .instruction-item {
                font-size: 0.8em;
              }
              
              .sheet-music {
                padding: 10px;
                gap: 8px;
              }
              
              .note-box {
                width: 35px;
                height: 55px;
              }
              
              .note-name {
                font-size: 1.1em;
              }
              
              .sheet-music-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
              }
            }

            @media (max-width: 480px) {
              .piano-container {
                padding: 15px;
              }

              .white-key {
                width: 38px;
                height: 140px;
                font-size: 0.6em;
              }

              .black-key {
                width: 22px;
                height: 85px;
                font-size: 0.6em;
              }

              .keys-container {
                height: 140px;
              }

              .volume-control {
                flex-direction: column;
                gap: 5px;
              }

              .volume-slider {
                width: 60px;
              }
              
              .note-box {
                width: 30px;
                height: 50px;
              }
              
              .note-name {
                font-size: 0.9em;
              }
              
              .note-box .key-binding {
                font-size: 0.7em;
                padding: 1px 3px;
              }
            }
          `}</style>
        </div>
      );
    };

    // 在DOM中渲染Piano组件
    ReactDOM.createRoot(document.getElementById('root')).render(
      <React.StrictMode>
        <Piano />
      </React.StrictMode>
    );
  </script>
</body>
</html>